<!doctype html>
<html lang="es">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="author" content="MND" />
<meta name="description" content="CIFO La Violeta">
<meta name="keywords" content="formacion, SOC, CIFO, formaciÃ³n digital" />

<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<!-- Fonts CSS -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/icon?family=Material+Icons">
<!-- Custom CSS -->
<link rel="stylesheet" href="css/cifo.css">
<link rel="icon" href="img/favicon.ico" type="image/gif" sizes="16x16">


<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap4.min.css">

<title>CIFO La Violeta</title>
</head>
<body class="container-fluid">
	<div data-include="Nav.html"></div>
	<div data-include="Header.html"></div>

	<section class="row">

		<div class="col-12 col-md-3">
			<button class="btn btn-primary m-3" type="button"
				data-toggle="collapse" data-target="#collapseSelect1"
				aria-expanded="false" aria-controls="collapseExample">
				<span class='fa fa-filter'></span>Filtro<span
					class='fa fa-caret-down'></span>
			</button>
			<div class="collapse" id="collapseSelect1">
				<select class="custom-select" id="area">
					<option selected value='0'>Selecciona Area</option>
				</select> <select class="custom-select my-3" id="centro">
					<option selected value='0'>Selecciona Centro</option>
				</select>

			</div>
			<button class="btn btn-primary mb-5 mt-3 mx-3 d-block" type="button"
				data-toggle="collapse" data-target="#collapseSelect2"
				aria-expanded="false" aria-controls="collapseExample">Button
				with data-target</button>

			<div class="collapse pb-3" id="collapseSelect2">
				<div class="card card-body">Anim pariatur cliche
					reprehenderit, enim eiusmod high life accusamus terry richardson ad
					squid. Nihil anim keffiyeh helvetica, craft beer labore wes
					anderson cred nesciunt sapiente ea proident.</div>
			</div>


		</div>
		<div class="col-12 col-md-9">
			<table id="tblOfertas"
				class="table table-striped table-bordered dt-responsive nowrap"
				style="width: 80%">


			</table>




		</div>
	</section>




	<div data-include="Footer.html"></div>


	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
		type="text/javascript"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
		type="text/javascript"></script>
	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		type="text/javascript"></script>


	<!-- DataTables -->
	<script
		src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"
		charset="utf8" type="text/javascript"></script>

	<script
		src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js">
		
	</script>
	<script type="text/javascript"
		src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
	<script>
	  /* Fem la crida al llistat d'areas i omplim el selector */
		var xhr= new XMLHttpRequest();
		
		xhr.addEventListener('load',()=>{
			
			var objAreas = JSON.parse(xhr.responseText);

			for (var i=0;i<objAreas.records.length;i++){

				document.getElementById('area').innerHTML += `<option value='${objAreas.records[i].id}'>${objAreas.records[i].nombre}</option>`
			}
			
			
		})	
		
		xhr.open("GET", "http://app.cifo.local/api/public/formacion/areas/", true);
		xhr.send();
	
	/* Fem la crida al llistat de centres i omplim el selector */	  
		var xhr2= new XMLHttpRequest();
			
			xhr2.addEventListener('load',()=>{
				
				var objCentros = JSON.parse(xhr2.responseText);

				for (var i=0;i<objCentros.records.length;i++){

					document.getElementById('centro').innerHTML += `<option value='${objCentros.records[i].id}'>${objCentros.records[i].nombre}</option>`
				}
				
				
			})	
			
			xhr2.open("GET", "http://app.cifo.local/api/public/formacion/centros/", true);
			xhr2.send();
		/* Carreguem la pagina al modificar l'area */	
	
		document.getElementById('area').addEventListener('change', ()=>{
		var xhr3= new XMLHttpRequest();
	
		xhr3.addEventListener('load',()=>{
			document.getElementById('tblOfertas').innerHTML = '';
			var objOfertas = JSON.parse(xhr3.responseText);
			for (var i=0;i<objOfertas.records.length;i++){
				var modelCursos =`<tr>
			    	<td>${objOfertas.records[i].id}</td>
			    	<td>${objOfertas.records[i].curso}</td>
			    	<td>${objOfertas.records[i].datainicio}</td>
			    	<td>${objOfertas.records[i].datafin}</td>
			    	<td>${objOfertas.records[i].horario}</td>
			  		</tr>`
			  		
			document.getElementById('tblOfertas').innerHTML += modelCursos;
			}
	
	
		})	
			var centroSel=document.getElementById('centro').value
			if (centroSel== '0'){
				xhr3.open("GET", `http://app.cifo.local/api/public/formacion/ofertas/area/${event.target.value}/`, true);				
			}
			else{
				xhr3.open("GET", `http://app.cifo.local/api/public/formacion/ofertas/area/${event.target.value}/centro/${centroSel}/`, true);
			}
			xhr3.send();
		});
		
		/* Carreguem la pagina al modificar el centre */	
		
		document.getElementById('centro').addEventListener('change', ()=>{
		var xhr4= new XMLHttpRequest();
	
		xhr4.addEventListener('load',()=>{
			document.getElementById('tblOfertas').innerHTML = '';
			var objOfertas = JSON.parse(xhr4.responseText);

			for (var i=0;i<objOfertas.records.length;i++){
				var modelCursos =`<tr>
			    	<td>${objOfertas.records[i].id}</td>
			    	<td>${objOfertas.records[i].curso}</td>
			    	<td>${objOfertas.records[i].datainicio}</td>
			    	<td>${objOfertas.records[i].datafin}</td>
			    	<td>${objOfertas.records[i].horario}</td>
			  		</tr>`
			  		
				document.getElementById('tblOfertas').innerHTML += modelCursos;
				}
	
	
			});	
			var areaSel=document.getElementById('area').value
			if (areaSel== '0'){
				xhr4.open("GET", `http://app.cifo.local/api/public/formacion/ofertas/centro/${event.target.value}/`, true);				
			}
			else{
				xhr4.open("GET", `http://app.cifo.local/api/public/formacion/ofertas/area/${areaSel}/centro/${event.target.value}/`, true);
			}
			xhr4.send();
		});
		$(document).ready(function() {
			$('#tblOfertas').DataTable();
		});
		
	</script>

</body>
</html>