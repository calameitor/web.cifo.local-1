<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <meta name="author" content="TBM" />
  <meta name="description" content="CIFO La Violeta">
  <meta name="keywords" content="formacion, SOC, CIFO, formaciÃ³n digital" />

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
  <!-- Fonts CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/cifo.css">
  <link rel="icon" href="img/favicon.ico" type="image/gif" sizes="16x16">


  <!-- DataTables CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" />

  <title>CIFO La Violeta</title>
</head>

<body class="container-fluid">
  <div data-include="Nav.html"></div>
  <div data-include="Header.html"></div>



  <!-- <button class="btn btn-primary my-3" type="button" data-toggle="collapse" data-target="#collapseSelect1" aria-expanded="false" aria-controls="collapseExample">
        Selecciona Secion Editorial<span class='fa fa-caret-down'></span>
      </button>
      <div class="collapse" id="collapseSelect1">
        <select class="custom-select my-3" id="centro">
          <option selected value=''>Selecciona seccion</option>
        </select> <select class="custom-select mb-3" id="area">
          <option selected value=''>Selecciona Editorial</option>
        </select>

      </div> -->


  <div class="row">
    <div class="col-12 col-md-4">
      <div class="card h-100">
        <div class="card-header">
          Filtro
        </div>
        <div class="card-body">
          Seccion
          <select class="form-control" id="tblSecciones">
            <option value="">-- Elija una opcion --</option>
          </select>
        </div>
        <div class="card-body">
          Temas
          <select class="form-control" id="tblTemas">
            <option value="">-- Elija una opcion --</option>
          </select>
        </div>
        <div class="card-body">
          Editoriales
          <select class="form-control" id="tblEditoriales">
            <option value="">-- Elija una opcion --</option>
          </select>
        </div>
        <div class="d-flex justify-content-center mt-5">
          <button type="button" id="btnBorrar" class="btn btn-danger mr-1">Borrar</button>
          <button type="button" id="btnFiltrar" class="btn btn-info ml-1">Filtrar</button>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-8">
      <div class="card h-100">
        <div class="card-header">
          Libros
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table id="tbllibros" class="table small">
              <thead>
                <tr>
                  <th>Isbn</th>
                  <th>Cubierta</th>
                  <th>Titulo</th>
                  <th>Editorial</th>
                  <th>Seccion</th>
                  <th>Tema</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================== div#modalAjax ======================= -->
  <div id="ajaxModal" class="modal" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered justify-content-center" role="document">
      <div class="spinner-border text-light">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
  </div>

  <!-- =========================== div#libroModal ===================== -->
  <!-- Modal -->
  <div class="modal fade" id="libroModal" tabindex="-1" role="dialog" aria-labelledby="cursoModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cursoModalLabel">Ficha de Curso</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div data-include="Footer.html"></div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" type="text/javascript"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" type="text/javascript"></script>

  <!-- Datatable -->
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>



  <script src="js/multipage.js" type="text/javascript"></script>
  <script>
    // ******************************************   relleno datatable ***************************************************************


    var tabla = $('#tbllibros').DataTable({
      language: {
        url: "./spanish.datatable.json"
      },
      lengthMenu: [5, 10, 25, 50, 75, 100],
      pageLength: 5,
      columnDefs: [{
          "data": "isbn",
          "targets": 0
        },
        {
          "data": "cubierta",
          "targets": 1
        },
        {
          "data": "titulo",
          "targets": 2
        },
        {
          "data": "editorial",
          "targets": 3
        },
        {
          "data": "seccion",
          "targets": 4
        },
        {
          "data": "tema",
          "targets": 5
        }
      ]

    });
    $('#ajaxModal').modal('show');


    /* ------------------------------------- get libros ----------------------------- */
    var xhr;
    xhr = new XMLHttpRequest();

    xhr.onreadystatechange = function() {
      if (xhr.readyState == 4 && xhr.status == 200) {
        var objLibros = JSON.parse(xhr.responseText);

			//console.log(objOfertas);
			var arrLibros = objLibros.records;
			//console.log(arrOfertas);
			for(var i=0; i<arrLibros.length; i++){
            tabla.row.add({
              //"Isbn"		: '<a href="javascript:void(0)" onclick="viewLibro('+objResponse.records[i].id+')>'+objResponse.records[i].isbn+'</a>',
              "isbn": objLibros.records[i].isbn,
              "cubierta": '<img src="' + objLibros.records[i].cubierta + '" height="30px">',
              "titulo": objLibros.records[i].titulo,
              "editorial": objLibros.records[i].editorial,
              "seccion": objLibros.records[i].seccion,
              "tema": objLibros.records[i].tema
            });
          }
          tabla.draw();
          $('#ajaxModal').modal('hide');
        }
      }

    xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/', true);
    xhr.send();

    /* ----------------------------------- GEt Secciones  llamada AJAX--------------------------- */
    var xhr1;
    xhr1 = new XMLHttpRequest();


    xhr1.onreadystatechange = function() {
      if (xhr1.readyState == 4 && xhr1.status == 200) {
        var objSecciones = JSON.parse(xhr1.responseText);
        var arrSecciones = objSecciones.records;

        if (objSecciones.status) {
          for (var j = 0; j < arrSecciones.length; j++) {
            var cadena = '<option value="' + arrSecciones[j].id + '">' + arrSecciones[j].nombre + '</option>';
            document.getElementById('tblSecciones').innerHTML += cadena;

          }
        }
      }
    }
    xhr1.open('GET', 'http://app.cifo.local/api/public/biblioteca/secciones/', true);
    xhr1.send();





    /* ********************************************************* GET TEMAS  llamada AJAX ********************************************************** */



    document.getElementById("tblSecciones").onchange = function() {

      document.getElementById("tblTemas").innerHTML = '<option value="">-- Escoge un Tema --</option>';

      var xhr;
      xhr = new XMLHttpRequest();

      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          var arrTemas = JSON.parse(this.responseText);
          console.log(arrTemas.status);
          console.log(arrTemas.records);

          for (j in arrTemas.records) {
            var cadena = '<option value=' + arrTemas.records[j].id + '>';
            cadena += arrTemas.records[j].nombre + '</option>';
            document.getElementById('tblTemas').innerHTML += cadena;
          }
        }
      }
      xhr.open("GET", "http://app.cifo.local/api/public/biblioteca/temas/seccion/" + this.value + "/" + "&nocache=" + Math.random(), true);
      xhr.send(null);
    }

    /* ======================= GET EITORILES     llamada AJAX ============================== */
document.getElementById('tblTemas').onchange = function() {

    var xhr;

    xhr = new XMLHttpRequest();


    xhr.onreadystatechange = function() {
      if (xhr.readyState == 4 && xhr.status == 200) {
        var arrEditoriales = JSON.parse(this.responseText);
        console.log(arrEditoriales.status);
        console.log(arrEditoriales.records);

        for (j in arrEditoriales.records) {
          var cadena = '<option value=' + arrEditoriales.records[j].id + '>';
          cadena += arrEditoriales.records[j].nombre + '</option>';
          document.getElementById('tblTemas').innerHTML += cadena;
        }
      }
    }
    xhr.open("GET", "http://app.cifo.local/api/public/biblioteca/temas/seccion/" + this.value + "/" + "&nocache=" + Math.random(), true);
    xhr.send(null);
  }
    // ******************************************     filtraje ************************************************

    //
    //     document.getElementById("btnFiltrar").onclick = function(){
    // tabla.clear().draw();
    // var SeccionesId = document.getElementById("tblSecciones").value;
    // var LibrosId = document.getElementById("tblTemas").value;




    // function viewLibro(id) {
    //   document.querySelector('#libroModal .modal-body ').innerHTML = '';
    //   $('#ajaxModal').modal('show');
    //   xhr.onreadystatechange = function() {
    //     if (xhr.readyState == 4 && xhr.status == 200) {
    //       var objResponse = JSON.parse(xhr.responseText);
    //       if (objResponse.status) {
    //         for (key in objResponse.record) {
    //           console.log(key);
    //           var cadena = `<p>${key}: ${objResponse.record[key]}</p>`;
    //           document.querySelector('#libroModal .modal-body ').innerHTML += cadena;
    //         }
    //         $('#ajaxModal').modal('hide');
    //         $('#libroModal').modal('show');
    //       }
    //     }
    //   }
    //   xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/' + id + '/', true);
    //   xhr.send();
    // }
  </script>







</body>


</html>
