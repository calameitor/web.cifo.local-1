<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <meta name="author" content="TBM" />
  <meta name="description" content="CIFO La Violeta">
  <meta name="keywords" content="formacion, SOC, CIFO, formación digital" />

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
  <!-- Fonts CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/cifo.css">
  <link rel="icon" href="img/favicon.ico" type="image/gif" sizes="16x16">


  <!-- DataTables CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" />

  <title>CIFO La Violeta</title>
</head>

<body class="container-fluid">
  <div data-include="Nav.html"></div>
  <div data-include="Header.html"></div>



  <!-- <button class="btn btn-primary my-3" type="button" data-toggle="collapse" data-target="#collapseSelect1" aria-expanded="false" aria-controls="collapseExample">
        Selecciona Secion Editorial<span class='fa fa-caret-down'></span>
      </button>
      <div class="collapse" id="collapseSelect1">
        <select class="custom-select my-3" id="centro">
          <option selected value=''>Selecciona seccion</option>
        </select> <select class="custom-select mb-3" id="area">
          <option selected value=''>Selecciona Editorial</option>
        </select>

      </div> -->


  <div class="row">
    <div class="col-12 col-md-4">
      <div class="card h-100">
        <div class="card-header">
          Filtro
        </div>
        <div class="card-body">
          Seccion
          <select class="form-control" id="tblSecciones">
            <option value="">-- Elija una opcion --</option>
          </select>
        </div>
        <div class="card-body">
          Temas
          <select class="form-control" id="tblTemas">
            <option value="">-- Elija una opcion --</option>
          </select>
        </div>
        <div class="card-body">
          Editoriales
          <select class="form-control" id="tblEditoriales">
            <option value="">-- Elija una opcion --</option>
          </select>
        </div>
        <div class="d-flex justify-content-center mt-5">
          <button type="button" id="btnBorrar" class="btn btn-danger mr-1">Borrar</button>
          <button type="button" id="btnFiltrar" class="btn btn-info ml-1">Filtrar</button>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-8">
      <div class="card h-100">
        <div class="card-header">
          Libros
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table id="tbllibros" class="table small">
              <thead>
                <tr>
                  <th>Isbn</th>
                  <th>Cubierta</th>
                  <th>Titulo</th>
                  <th>Editorial</th>
                  <th>Seccion</th>
                  <th>Tema</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================== div#modalAjax ======================= -->
  <div id="ajaxModal" class="modal" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered justify-content-center" role="document">
      <div class="spinner-border text-light">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
  </div>

  <!-- =========================== div#libroModal ===================== -->
  <!-- Modal -->
  <div class="modal fade" id="libroModal" tabindex="-1" role="dialog" aria-labelledby="cursoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cursoModalLabel"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="accordion" id="accordionExample">

              <div class="d-flex justify-content-between">
                <!--  -between  -->
                <div id="parrafo1-1" class="p-2 flex-grow-1 w-75">
                  <!-- flex-fill -->
                  <!-- flex-grow-1 -->
                </div>
                <div id="parrafo1-2" class="p-2 flex-shrink-1 d-flex align-items-stretch mw-25">
                  <!-- d-flex align-items-stretch -->
                </div>
              </div>

              <div class="card">
                <div class="card-header" id="headingTwo">
                  <h2 class="mb-0">
                    <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                      Descripción</button>
                  </h2>
                </div>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                  <div class="card-body"></div>
                </div>
              </div>
              <div class="card">
                <div class="card-header" id="headingThree">
                  <h2 class="mb-0">
                    <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                      Autores</button>
                  </h2>
                </div>
                <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                  <div class="card-body"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <!--  <button type="button" class="btn btn-primary">Save changes</button> -->
        </div>
      </div>
    </div>
  </div>


  <div data-include="Footer.html"></div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" type="text/javascript"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" type="text/javascript"></script>

  <!-- Datatable -->
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>



  <script src="js/multipage.js" type="text/javascript"></script>
  <script>

    /* ----------------------------------- GEt Secciones  llamada AJAX--------------------------- */
    var xhr;
    xhr = new XMLHttpRequest();


    xhr.onreadystatechange = function() {
      if (xhr.readyState == 4 && xhr.status == 200) {
        var objSecciones = JSON.parse(xhr.responseText);
        var arrSecciones = objSecciones.records;

        if (objSecciones.status) {
          for (var j = 0; j < arrSecciones.length; j++) {
            var cadena = '<option value="' + arrSecciones[j].id + '">' + arrSecciones[j].nombre + '</option>';
            document.getElementById('tblSecciones').innerHTML += cadena;

          }
        }
      }
    }
    xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/secciones/', true);
    xhr.send();





    /* ********************************************************* GET TEMAS  llamada AJAX ********************************************************** */



    document.getElementById("tblSecciones").onchange = function() {
      document.getElementById("tblTemas").innerHTML = '<option value="">-- Escoge un Tema --</option>';

      var xhr;
      xhr = new XMLHttpRequest();

      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          var arrTemas = JSON.parse(this.responseText);
          console.log(arrTemas.status);
          console.log(arrTemas.records);

          for (j in arrTemas.records) {
            var cadena = '<option value=' + arrTemas.records[j].id + '>';
            cadena += arrTemas.records[j].nombre + '</option>';
            document.getElementById('tblTemas').innerHTML += cadena;
          }
        }
      }
      xhr.open("GET", "http://app.cifo.local/api/public/biblioteca/temas/seccion/" + this.value + "/" + "&nocache=" + Math.random(), true);
      xhr.send(null);

}


      /* ======================= GET EITORILES     llamada AJAX ============================== */



      var xhr8;
      xhr8 = new XMLHttpRequest();
      xhr8.onreadystatechange = function() {
        if (xhr8.readyState == 4 && xhr8.status == 200) {
          var arrEditoriales = JSON.parse(this.responseText);
          console.log(arrEditoriales.status);
          console.log(arrEditoriales.records);

          for (j in arrEditoriales.records) {
            var cadena = '<option value=' + arrEditoriales.records[j].id + '>';
            cadena += arrEditoriales.records[j].nombre + '</option>';
            document.getElementById('tblEditoriales').innerHTML += cadena;
          }
        }

      }
      xhr8.open("GET", "http://app.cifo.local/api/public/biblioteca/editoriales/", true);
      xhr8.send();

      // ******************************************   relleno datatable ***************************************************************


      var tabla = $('#tbllibros').DataTable({
        language: {
          url: "./spanish.datatable.json"
        },
        lengthMenu: [5, 10, 25, 50, 75, 100],
        pageLength: 5,
        columnDefs: [{
            "data": "isbn",
            "targets": 0
          },
          {
            "data": "cubierta",
            "targets": 1
          },
          {
            "data": "titulo",
            "targets": 2
          },
          {
            "data": "editorial",
            "targets": 3
          },
          {
            "data": "seccion",
            "targets": 4
          },
          {
            "data": "tema",
            "targets": 5
          }
        ]

      });
      $('#ajaxModal').modal('show');


      /* ------------------------------------- get libros ----------------------------- */


      var xhr7;
      xhr7 = new XMLHttpRequest();

      xhr7.onreadystatechange = function() {
        if (xhr7.readyState == 4 && xhr7.status == 200) {
          var objLibros = JSON.parse(xhr7.responseText);

          console.log(objLibros);
          var arrLibros = objLibros.records;
          console.log(arrLibros);
          for (var i = 0; i < arrLibros.length; i++) {
            tabla.row.add({
              //"Isbn"		: '<a href="javascript:void(0)" onclick="viewLibro('+objLibros.records[i].id+')>'+objLibros.records[i].isbn+'</a>',
             "isbn": objLibros.records[i].isbn,
             "cubierta": '<img src="' + objLibros.records[i].cubierta + '" height="30px">',
              "titulo": objLibros.records[i].titulo,
              "editorial": objLibros.records[i].editorial,
              "seccion": objLibros.records[i].seccion,
              "tema": objLibros.records[i].tema
            });
          }
          tabla.draw();
          $('#ajaxModal').modal('hide');
        }
      }

      xhr7.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/', true);
      xhr7.send();


      //
      // <!-- *********************************************   filtraje   relleno datatable via AJAX**************************************************** -->


      document.getElementById("btnFiltrar").onclick = function() {

        tabla.clear().draw();
        var seccionId = document.getElementById("tblSecciones").value;
        var temasId = document.getElementById("tblTemas").value;
        var editorialId = document.getElementById("tblEditoriales").value;
        console.log(seccionId);
        console.log(temasId);
        console.log(editorialId);
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4 && xhr.status == 200) {
            var objLibros = JSON.parse(xhr.responseText);
            var arrLibros = objLibros.records;
            console.log(objLibros);
            console.log(arrLibros);
            for (var i = 0; i < arrLibros.length; i++) {
              tabla.row.add({
                //"Isbn": '<a href="javascript:void(0)" onclick="viewLibro(' + objLibros.records[i].id + ')>' + objLibros.records[i].isbn + '</a>',

                "isbn": objLibros.records[i].isbn,
                "cubierta": '<img src="' + objLibros.records[i].cubierta + '" height="30px">',
                "titulo": objLibros.records[i].titulo,
                "editorial": objLibros.records[i].editorial,
                "seccion": objLibros.records[i].seccion,
                "tema": objLibros.records[i].tema
              })
            }
            tabla.draw();

          }
        }



        if (seccionId == "" && temasId == "") {
          xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/', true);

        }

        if (!seccionId == "" && temasId == "") {
          xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/seccion/' + seccionId + '/', true);

        }

        if (!seccionId == "" && !temasId == "") {
          xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/seccion/' + seccionId + '/tema/' + temasId + '/', true);

        }



        if (seccionId == "" && !editorialId == "") {
          xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/editoriales/' + editorialId + '/', true);

        }


        if (!seccionId == "" && !editorialId == "") {
          xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/seccion/' + seccionId + '/editorial/' + editorialId + '/', true);

        }


        if (!seccionId == "" && !temasId == "" && !editorialId == "") {
          xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/seccion/' + seccionId + '/tema/' + temasId + '/editorial/' + editorialId + '/', true);

        }
        xhr.send();

      }

      // ************************************************  boton de borraje ****************************************************

      document.getElementById("btnBorrar").onclick = function() {
        document.getElementById("tblSecciones").value = "";
        document.getElementById("tblTemas").value = "";
        document.getElementById("tblEditoriales").value = "";
      }

      // ***************************************************** modal libro ********************************************************

  //     function viewLibro(id){
  //  		console.log(id);
  // 	 	//------------------------------LLamada Ajax para centros modal----------------------------------
  // 	 	xhr.onreadystatechange = function(){
  // 	 		if(xhr.readyState==4 && xhr.status==200){
  // 	 			var objlibroModal = JSON.parse(xhr.responseText);
  // 				console.log(objlibroModal);
  // 				var libroModal = objOfertaCentros.record;
  // 				console.log(libroModal);
  // 				var values =Object.values(libroModal);
  // 				console.log(values);
  // 				document.getElementById("modCodOferta").innerHTML = values[1];
  // 				document.getElementById("modCurso").innerHTML = values[10].nombre;
  // 				document.getElementById("modFInicio").innerHTML = values[2];
  // 				document.getElementById("modFFin").innerHTML = values[3];
  // 				document.getElementById("modPlazas").innerHTML = values[5];
  // 				document.getElementById("modProfesor").innerHTML = values[13].nombre +" "+ values[13].apellidos;
  // 				document.getElementById("modDuracion").innerHTML = values[10].duracion;
  // 				document.querySelector("#collapseOne div").innerHTML = values[10].objetivos;
  // 				document.querySelector("#collapseTwo div").innerHTML = values[10].programa;
  // 				document.getElementById("center").innerHTML = values[12].nombre;
  // 				document.getElementById("tf").innerHTML = values[12].telefono;
  // 				document.getElementById("mail").innerHTML = values[12].buzon;
  // 				document.getElementById("calendar").innerHTML = values[12].horario;
  // 				document.getElementById("address").innerHTML = values[12].direccion;
  // 				document.getElementById("acceso").innerHTML = values[12].acceso;
  // 				document.getElementById("acceso").innerHTML = values[12].acceso;
  // 				var imgCentro='<img src="' + values[12].media+'" class="w-100" style="object-fit:cover">' ;
  // 				document.getElementById("img").innerHTML=imgCentro;
  // 	 		}
  //
  //
  // 		xhr.open('GET','http://app.cifo.local/api/public/biblioteca/' + id +'/', true);
  // 	 	xhr.send();
	// }
  // 	 	$('#modalCentro').modal('show')
  // 	 }

  </script>
</body>


</html>
